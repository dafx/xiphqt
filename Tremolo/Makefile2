# Tremolo Makefile for Windows CE port
# Uses the VLC toolchain
# $URL$
# $Id$

srcdir    = .
VPATH     = $(srcdir)

CC     = arm-none-linux-gnueabi-gcc
CXX    = arm-none-linux-gnueabi-g++
LD     = arm-none-linux-gnueabi-g++
AR     = arm-none-linux-gnueabi-ar cru
RANLIB = arm-none-linux-gnueabi-ranlib
STRIP  = arm-none-linux-gnueabi-strip
WINDRES= arm-none-linux-gnueabi-windres
MKDIR  = mkdir -p
RM     = rm -f
RM_REC = rm -rf
ECHO   = echo -n
CAT    = cat
AS     = arm-none-linux-gnueabi-as

DEFINES := 

CFLAGS := -g -mcpu=cortex-a8 -mfpu=neon -I$(srcdir) -D__ARM__ -D_ARM_

CXXFLAGS := $(CFLAGS)

#LDFLAGS := -L/opt/mingw32ce -Llibs/lib -lmingw32
LDFLAGS :=
LIBS :=

OBJS := 
MODULE_DIRS += .

LIBOBJS := bitwise.o bitwiseARM.o codebook.o dsp.o floor0.o \
           floor1.o floor1ARM.o floor_lookup.o framing.o info.o mapping0.o \
           mdct.o mdctARM.o misc.o res012.o vorbisfile.o
EXEOBJS := testtremor.o

#LIBOBJS_C := bitwise.oc codebook.oc dsp.oc floor0.oc floor1.oc \
#             floor_lookup.oc framing.oc info.oc mapping0.oc mdct.oc misc.oc \
#             res012.oc vorbisfile.oc
LIBOBJS_C := bitwise.oc codebook.oc dsp.oc floor0.oc \
	     floor1.oc floor_lookup.oc framing.oc info.oc mapping0.oc \
	     mdct.oc misc.oc res012.oc vorbisfile.oc
EXEOBJS_C := testtremor.oc

LIBOBJS_L := bitwise.ol bitwiseARM.o codebook.ol dsp.ol floor0.ol \
             floor1.ol floor1LARM.o floor_lookup.ol framing.ol info.ol mapping0.ol \
             mdct.ol mdctLARM.o misc.ol res012.ol vorbisfile.ol
EXEOBJS_L := testtremor.ol

LIBOBJS_LC := bitwise.olc codebook.olc dsp.olc floor0.olc floor1.olc \
              floor_lookup.olc framing.olc info.olc mapping0.olc mdct.olc misc.olc \
              res012.olc vorbisfile.olc
EXEOBJS_LC := testtremor.olc

# Rules
.SUFFIXES: .o .oc .ol .olc

.c.o:
	$(CC) $(CFLAGS) -c $(<) -o $*.o -D_ARM_ASSEM_

.c.oc:
	$(CC) $(CFLAGS) -c $(<) -o $*.oc -DONLY_C

.c.ol:
	$(CC) $(CFLAGS) -c $(<) -o $*.ol -D_LOW_ACCURACY_ -D_ARM_ASSEM_

.c.olc:
	$(CC) $(CFLAGS) -c $(<) -o $*.olc -D_LOW_ACCURACY_ -DONLY_C
.S.s:
	./arm2gnu.pl < $(<) > $*.s

all: libTremolo.lib testtremor.exe testtremorC.exe testtremorL.exe testtremorLC.exe

libTremolo.lib: $(LIBOBJS)
	$(AR) $@ $^
	$(RANLIB) $@

#bitwiseTEST.o: bitwise.c
#	$(CC) $(CFLAGS) -c -o bitwiseTEST.o bitwise.c -D_V_BIT_TEST

#bittest.exe: bitwiseTEST.o bitwiseARM.o
#	$(LD) $^ $(LDFLAGS) $(LIBS) -o $@ -Wl,-Map,bittest.exe.map

testtremor.exe: testtremor.o $(LIBOBJS)
	$(LD) $^ $(LDFLAGS) $(LIBS) -o $@ -Wl,-Map,testtremor.exe.map

testtremorC.exe: testtremor.oc $(LIBOBJS_C)
	$(LD) $^ $(LDFLAGS) $(LIBS) -o $@ -Wl,-Map,testtremorC.exe.map

testtremorL.exe: testtremor.ol $(LIBOBJS_L)
	$(LD) $^ $(LDFLAGS) $(LIBS) -o $@ -Wl,-Map,testtremorL.exe.map

testtremorLC.exe: testtremor.olc $(LIBOBJS_LC)
	$(LD) $^ $(LDFLAGS) $(LIBS) -o $@ -Wl,-Map,testtremorLC.exe.map

annotate.exe: annotate.c
	gcc $^ -o $@

clean:
	rm `find . -name \*.o`
	rm `find . -name \*.ol`
	rm `find . -name \*.oc`
	rm `find . -name \*.olc`
